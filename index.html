<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftNotes Cloud Pro | Secure Edition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="icon" type="image/png" href="img1.png">

    <style>
        :root { --bg-color: #f4f7f6; --glass: rgba(255, 255, 255, 0.9); --primary-accent: #6366f1; }
        body { background-color: var(--bg-color); font-family: 'Inter', sans-serif; transition: 0.3s; overflow-x: hidden; }
        .glass-card { background: var(--glass); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 20px; }
        
        /* Sidebar Styling */
        .sidebar-nav { height: calc(100vh - 2rem); position: fixed; top: 1rem; left: 1rem; width: 16%; padding: 2rem; z-index: 1000; display: flex; flex-direction: column; }
        .sidebar-item:hover { background: rgba(99, 102, 241, 0.1); color: var(--primary-accent); cursor: pointer; }
        
        /* Brand Image & 20s Animation */
        .brand-container { width: 100%; margin-bottom: 3rem; text-align: center; }
        .brand-logo { width: 100%; height: auto; max-height: 200px; object-fit: contain; border-radius: 12px; animation: brandPulse 5s infinite ease-in-out; }

        @keyframes brandPulse {
            0%, 90%, 100% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(99,102,241,0)); }
            95% { transform: scale(1.05); filter: drop-shadow(0 0 15px rgba(99,102,241,0.4)); }
        }

        /* Status Hub at Bottom */
        .status-hub { margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(0,0,0,0.05); font-size: 0.75rem; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .online-dot { background: #22c55e; box-shadow: 0 0 8px #22c55e; animation: pulse 2s infinite; }
        .offline-dot { background: #ef4444; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        .dark-mode { --bg-color: #0f172a; --glass: rgba(30, 41, 59, 0.8); color: #f1f5f9; }
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 3000; display: flex; align-items: center; justify-content: center; }
        #editor-container { height: 350px; background: white; border-radius: 0 0 15px 15px; }
        .ql-toolbar { border-radius: 15px 15px 0 0; background: #f8fafc; border-color: #ddd !important; }
        .dict-container { position: relative; flex-grow: 1; margin: 0 20px; }
        #dictResults { position: absolute; top: 100%; left: 0; right: 0; z-index: 2000; display: none; margin-top: 5px; }
        .loading-bar { position: fixed; top: 0; left: 0; height: 3px; background: var(--primary-accent); transition: 0.3s; z-index: 2000; width: 0%; }
        .note-card { border: none; border-radius: 18px; transition: 0.3s; cursor: pointer; }
        .note-card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.08) !important; }
        
        /* Toast Position */
        .toast-container { z-index: 4000; }
    </style>
</head>
<body>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="liveToast" class="toast glass-card border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-body d-flex align-items-center gap-2">
            <i id="toastIcon" class="bi bi-info-circle text-primary"></i>
            <span id="toastMsg">Action Successful</span>
        </div>
    </div>
</div>

<div id="loginOverlay">
    <div class="glass-card p-5 shadow-lg text-center" style="width: 400px;">
        <h3 class="fw-bold text-primary mb-4"><i class="bi bi-shield-lock"></i> Secure Access</h3>
        <input type="password" id="passInput" class="form-control mb-3 glass-card text-center" placeholder="Password">
        <button class="btn btn-primary w-100 rounded-pill" onclick="checkPass()">Unlock Workspace</button>
        <p id="loginError" class="text-danger small mt-2" style="display:none;">Access Denied</p>
    </div>
</div>

<div id="loader" class="loading-bar"></div>

<div class="container-fluid" id="mainContent" style="display:none;">
    <div class="row">
        <nav class="sidebar-nav glass-card d-none d-md-block shadow-sm">
            <div class="brand-container">
                <img src="img1.png" alt="Logo" class="brand-logo">
            </div>
            <ul class="nav flex-column gap-2">
                <li class="nav-item p-2 rounded sidebar-item active" onclick="fetchNotes()"><i class="bi bi-cloud-check me-2"></i> Sync Cloud</li>
                <li class="nav-item p-2 rounded sidebar-item text-danger mt-3" onclick="logout()"><i class="bi bi-box-arrow-left me-2"></i> Logout</li>
            </ul>

            <div class="status-hub">
                <div class="mb-2">
                    <span id="netStatusDot" class="status-dot online-dot"></span>
                    <span id="netStatusText" class="fw-bold">Connected</span>
                </div>
                <div class="text-muted">
                    <i class="bi bi-clock-history me-1"></i> Sync: <span id="lastSync">Never</span>
                </div>
                <div class="text-muted mt-1">
                    <i class="bi bi-google me-1 text-success"></i> Sheets Active
                </div>
            </div>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-5 py-4" style="margin-left: 18% !important;">
            <header class="d-flex align-items-center mb-5">
                <h2 class="fw-bold mb-0">Study Hunt</h2>
                <div class="dict-container">
                    <input type="text" id="dictInput" class="form-control glass-card border-0 py-2 shadow-sm" placeholder="Search Dictionary...">
                    <ul id="dictResults" class="list-group glass-card shadow-lg"></ul>
                </div>
                <div class="d-flex gap-2">
                    <button id="themeToggle" class="btn glass-card border shadow-sm px-3"><i class="bi bi-moon"></i></button>
                    <button class="btn btn-primary px-4 shadow rounded-pill" onclick="openCreateModal()"><i class="bi bi-plus-lg me-2"></i> Create</button>
                </div>
            </header>

            <div class="glass-card p-3 mb-4 shadow-sm border-0 d-flex gap-3 align-items-center">
                <i class="bi bi-search text-muted ms-2"></i>
                <input type="text" id="searchInput" class="form-control border-0 bg-transparent" placeholder="Search notes...">
                <select id="filterCategory" class="form-select border-0 bg-transparent w-auto fw-bold text-primary">
                    <option value="All">All Categories</option>
                    <option value="ICD-10">ICD-10</option>
                    <option value="PCS">PCS</option>
                    <option value="CPT">CPT</option>
                </select>
            </div>
            <div id="notesGrid" class="row g-4"></div>
        </main>
    </div>
</div>

<div class="modal fade" id="noteModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content glass-card p-2 border-0 shadow-lg">
            <div class="modal-header border-0 d-flex justify-content-between">
                <h5 class="fw-bold" id="modalTitle">Note</h5>
                <div class="d-flex gap-2">
                    <button id="lockBtn" class="btn btn-sm btn-outline-secondary rounded-pill px-3"><i id="lockIcon" class="bi bi-unlock"></i> <span id="lockText">Unlocked</span></button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
            </div>
            <div class="modal-body">
                <input type="text" id="noteTitle" class="form-control mb-3 glass-card fs-4 fw-bold" placeholder="Title">
                <div id="editor-container"></div>
                <select id="noteCategory" class="form-select mt-3 glass-card">
                    <option value="ICD-10">ICD-10</option>
                    <option value="PCS">PCS</option>
                    <option value="CPT">CPT</option>
                </select>
            </div>
            <div class="modal-footer border-0">
                <button type="button" id="saveBtn" class="btn btn-primary w-100 rounded-pill py-2 shadow">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxpmVMzwRzSUq3nb-62zEC4mcFrSrcol6sRbjTF3J4oUVDEeyNy-tbnVWYh3ig0QSrW/exec"; 
    let notes = [];
    let currentEditId = null;
    let isLocked = false;
    
    function showToast(msg, iconClass = "bi-check-circle-fill") {
        document.getElementById('toastMsg').innerText = msg;
        document.getElementById('toastIcon').className = `bi ${iconClass}`;
        const toast = new bootstrap.Toast(document.getElementById('liveToast'));
        toast.show();
    }

    // Network Monitoring
    window.addEventListener('online', updateNetStatus);
    window.addEventListener('offline', updateNetStatus);
    function updateNetStatus() {
        const dot = document.getElementById('netStatusDot');
        const text = document.getElementById('netStatusText');
        if (navigator.onLine) {
            dot.className = "status-dot online-dot"; text.innerText = "Connected";
            showToast("Back online", "bi-wifi");
        } else {
            dot.className = "status-dot offline-dot"; text.innerText = "Disconnected";
            showToast("Connection lost", "bi-wifi-off text-danger");
        }
    }

    function checkPass() {
        if(document.getElementById('passInput').value === "admin") {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            fetchNotes();
        } else { document.getElementById('loginError').style.display = 'block'; }
    }
    function logout() { location.reload(); }

    const quill = new Quill('#editor-container', {
        theme: 'snow',
        modules: { toolbar: [[{font:[]}], [{header:[1,2,3,false]}], ['bold','italic','underline'], [{list:'ordered'},{list:'bullet'}], [{align:[]}], ['link','blockquote'], ['clean']] }
    });

    const dictionary = ["one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten"];
    document.getElementById('dictInput').addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        const res = document.getElementById('dictResults');
        res.innerHTML = '';
        if (!val) { res.style.display = 'none'; return; }
        const matches = dictionary.filter(s => s.includes(val));
        if (matches.length) {
            res.style.display = 'block';
            matches.forEach(m => {
                const li = document.createElement('li');
                li.className = 'list-group-item list-group-item-action border-0 py-2';
                li.textContent = m;
                li.onclick = () => { e.target.value = m; res.style.display = 'none'; };
                res.appendChild(li);
            });
        } else { res.style.display = 'none'; }
    });

    async function fetchNotes() {
        setLoad(40);
        try { 
            const res = await fetch(SCRIPT_URL); 
            notes = await res.json(); 
            render(); 
            document.getElementById('lastSync').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            setLoad(100); 
        } catch (e) { 
            setLoad(0); 
            showToast("Sync Failed", "bi-exclamation-triangle text-danger");
        }
    }

    function render(data = notes) {
        document.getElementById('notesGrid').innerHTML = data.map(n => `
            <div class="col-lg-4 col-md-6">
                <div class="card glass-card note-card shadow-sm h-100 p-3" onclick="openViewModal('${n.id}')">
                    <div class="d-flex justify-content-between mb-3">
                        <span class="badge bg-light text-primary border-0 rounded-pill px-3">${n.category}</span>
                        <div class="dropdown" onclick="event.stopPropagation()">
                            <i class="bi bi-three-dots-vertical" data-bs-toggle="dropdown"></i>
                            <ul class="dropdown-menu shadow border-0">
                                <li><a class="dropdown-item" onclick="exportPDF('${n.id}')"><i class="bi bi-file-pdf text-danger"></i> PDF</a></li>
                                <li><a class="dropdown-item text-danger" onclick="deleteNote('${n.id}')"><i class="bi bi-trash"></i> Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    <h5 class="fw-bold text-truncate">${n.title}</h5>
                    <div class="text-muted small overflow-hidden" style="max-height: 40px">${n.content}</div>
                </div>
            </div>`).join('');
    }

    document.getElementById('saveBtn').addEventListener('click', async () => {
        const payload = { id: currentEditId || Date.now().toString(), title: document.getElementById('noteTitle').value || "Untitled", content: quill.root.innerHTML, category: document.getElementById('noteCategory').value, date: new Date().toLocaleDateString() };
        setLoad(50);
        try {
            await fetch(`${SCRIPT_URL}?action=${currentEditId ? "update" : "add"}`, { method: 'POST', body: JSON.stringify(payload) });
            bootstrap.Modal.getInstance(document.getElementById('noteModal')).hide();
            fetchNotes();
            showToast("Note Saved!");
        } catch(e) { showToast("Error Saving", "bi-x-circle text-danger"); }
    });

    async function deleteNote(id) { 
        if(!confirm("Delete?")) return;
        setLoad(50);
        await fetch(`${SCRIPT_URL}?action=delete`, { method: 'POST', body: JSON.stringify({id}) });
        fetchNotes();
        showToast("Note Deleted", "bi-trash text-danger");
    }

    function updateLockUI() {
        quill.enable(!isLocked);
        document.getElementById('noteTitle').disabled = isLocked;
        document.getElementById('noteCategory').disabled = isLocked;
        document.getElementById('lockIcon').className = isLocked ? "bi bi-lock-fill" : "bi bi-unlock";
        document.getElementById('lockText').innerText = isLocked ? "Locked" : "Unlocked";
        document.getElementById('saveBtn').style.display = isLocked ? "none" : "block";
    }
    document.getElementById('lockBtn').addEventListener('click', () => { isLocked = !isLocked; updateLockUI(); });

    function openCreateModal() { currentEditId = null; isLocked = false; updateLockUI(); document.getElementById('modalTitle').innerText = "Create Note"; document.getElementById('noteTitle').value = ""; quill.setContents([]); new bootstrap.Modal(document.getElementById('noteModal')).show(); }
    function openViewModal(id) { const n = notes.find(x => x.id == id); currentEditId = id; isLocked = true; updateLockUI(); document.getElementById('modalTitle').innerText = "Viewing Note"; document.getElementById('noteTitle').value = n.title; quill.root.innerHTML = n.content; document.getElementById('noteCategory').value = n.category; new bootstrap.Modal(document.getElementById('noteModal')).show(); }
    function exportPDF(id) { const n = notes.find(x => x.id == id); const el = document.createElement('div'); el.style.padding = '40px'; el.innerHTML = `<h1>${n.title}</h1><hr>${n.content}`; html2pdf().from(el).save(`${n.title}.pdf`); }
    function setLoad(p) { document.getElementById('loader').style.width = p + "%"; if(p==100) setTimeout(()=>document.getElementById('loader').style.width="0%", 500); }
    document.getElementById('themeToggle').addEventListener('click', () => document.body.classList.toggle('dark-mode'));
    document.getElementById('searchInput').addEventListener('input', () => {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const cat = document.getElementById('filterCategory').value;
        render(notes.filter(n => (n.title.toLowerCase().includes(term) || n.content.toLowerCase().includes(term)) && (cat === 'All' || n.category === cat)));
    });


    // --- NEW: Dynamic Title Toggle Script ---
    let isOriginalTitle = true;
    const originalTitle = "Feel Free to learn..";
    const statusTitle = "Systems Online";

    setInterval(() => {
        document.title = isOriginalTitle ? statusTitle : originalTitle;
        isOriginalTitle = !isOriginalTitle;
    }, 1000); // Changes every 10 seconds

    // --- Rest of your logic (checkPass, fetchNotes, etc.) ---
</script>
</body>
</html>
